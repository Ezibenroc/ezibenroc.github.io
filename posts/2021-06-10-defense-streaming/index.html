<!DOCTYPE html>
<html lang="EN">
<head>
<!-- 08 Sep. 2021 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Streaming my PhD defense on YouTube</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Tom Cornebize">
<link href='../../css/stylesheet.css?v=ac24febb9ec9a45064c8f47a95510660f7e637cfdb58fb98e80019c0d9d1ead1' rel='stylesheet'/>
<link href='../../css/navbar.css?v=98f777c359db5da90dae26bcf8f5b8a1c5edb1ea8ce880bf06e3fb5d94353a07' rel='stylesheet'/>
<link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css' rel='stylesheet'/>
<meta description='Website of Tom Cornebize'/>
<link rel='alternate' type='application+rss/xml' title='Website of Tom Cornebize' href='posts/rss.xml'/>
</head>
<body>
<header id="preamble" class="status">
<div id="topnav">
    <ul>
        <li><a href="/">About</a></li>
        <li><a href=/projects.html>Projects</a></li>
        <li><a href=/publications.html>Publications</a></li>
        <li><a href=/posts/posts.html>Posts</a></li>
        <li class="right"><a href="https://www.linkedin.com/in/tomcornebize"                     class="list-group-item"><i class="fa fa-linkedin fa-fw"></i></a></li>
        <li class="right"><a href="https://scholar.google.com/citations?user=4YtfEysAAAAJ&hl=fr" class="list-group-item"><i class="fa fa-google fa-fw"></i></a></li>
        <li class="right"><a href="https://stackoverflow.com/users/4110059/tom-cornebize"        class="list-group-item"><i class="fa fa-stack-overflow fa-fw"></i></a></li>
        <li class="right"><a href="https://github.com/Ezibenroc/"                                class="list-group-item"><i class="fa fa-github fa-fw"></i></a></li>
        <li class="right"><a href="mailto:tom.cornebize@univ-grenoble-alpes.fr"                  class="list-group-item"><i class="fa fa-envelope fa-fw"></i></a></li>
    </ul>
</div>
</header>
<main id="content">
<header>
<h1 class="title">Streaming my PhD defense on YouTube</h1>
<p class="subtitle">Jun 10, 2021</p>
</header><p>
In this post, I describe the setup I used for my PhD defense. The jury and I
were in a video-conference with BigBlueButton (BBB) software, the defense was
also live-streamed on YouTube for the public. The resulting video can be found
<a href="https://youtu.be/J3N1qS5gcGI">here</a>.
</p>

<section id="outline-container-orgeee7791" class="outline-2">
<h2 id="orgeee7791">My system</h2>
<div class="outline-text-2" id="text-orgeee7791">
<p>
Some steps may differ, depending on your hardware and operating system. I used
my laptop, a Dell Latitude 5480 with an Intel i7-7820HQ CPU and 16 GB of
memory. The operating system was Debian 10, with Linux kernel <code>4.19.0-16-amd64</code>.
</p>

<p>
The defense was streamed with the OBS software. I installed it with the usual
<code>apt install</code> and got the package version <code>22.0.3+dfsg1-1</code>.
</p>
</div>
</section>
<section id="outline-container-org120ff2e" class="outline-2">
<h2 id="org120ff2e">What to stream?</h2>
<div class="outline-text-2" id="text-org120ff2e">
<p>
Initially, I wanted to directly stream the BBB window, for convenience. In BBB
you can upload the PDF of your slides and make your entire presentation within
BBB, with a nice dot pointer.
</p>

<p>
When I uploaded my slides however, BBB did not render them properly, the font
was wrong. My slides were done using LaTeX and Beamer, with the <a href="https://github.com/matze/mtheme">Metropolis</a>
theme, which uses Fira font. I fixed this by rasterizing the slides, as follows
(based on this <a href="https://superuser.com/questions/802569/how-to-distill-rasterize-a-pdf-in-linux/1588781#1588781">post</a>):
</p>
<div class="org-src-container">
<pre class="src src-sh">convert -density 600 +antialias slides.pdf output.pdf
gs -q -dNOPAUSE -dBATCH -dPDFSETTINGS=/prepress -sDEVICE=pdfwrite -sOutputFile=slides_rasterized.pdf output.pdf &amp;&amp; rm output.pdf
</pre>
</div>

<p>
However, I was unhappy about the result, I found the slides in the YouTube
stream not so pretty. In the end, I changed my setup. Instead of uploading the
slides to BBB I shared my screen, and instead of streaming the BBB window I
streamed the PDF viewer window.
</p>

<p>
I was used to the default PDF viewer on my system, <code>evince</code>. Thanks to my advisor,
I discovered the <a href="http://impressive.sourceforge.net/">impressive</a> viewer, which is much better for a presentation. I
launched it with this command:
</p>
<div class="org-src-container">
<pre class="src src-sh">impressive --noquit --tracking -T 100 -t Crossfade --fake-fullscreen -g 1920x1080 slides.pdf
</pre>
</div>
<p>
Pro-tip: in impressive, use <code>Enter</code> to focus on something and <code>Z</code> to zoom. Also,
read the man-page, it has a lot of very nice features.
</p>
</div>
</section>
<section id="outline-container-org01d417e" class="outline-2">
<h2 id="org01d417e">OBS setup</h2>
<div class="outline-text-2" id="text-org01d417e">
<p>
I describe here how I configured OBS itself.
</p>
</div>
<div id="outline-container-org0a3c820" class="outline-3">
<h3 id="org0a3c820">General settings</h3>
<div class="outline-text-3" id="text-org0a3c820">
<p>
In <code>File</code> then <code>Parameter</code>, I changed a few things.
</p>
<ul class="org-ul">
<li>In the <code>Stream</code> tab, I selected <code>YouTube/YouTube Gaming</code>. Here, I entered the
stream key (obtained from YouTube Studio).</li>
<li>In the <code>Output</code> tab, I changed the bitrate to 6000 (the default one was too low,
YouTube gave a warning).</li>
<li>In the <code>Video</code> tab, I changed both the base resolution and the output resolution
to 1920x1080. I also changed the FPS to 30.</li>
</ul>
</div>
</div>
<div id="outline-container-orga467a4f" class="outline-3">
<h3 id="orga467a4f">Scenes</h3>
<div class="outline-text-3" id="text-orga467a4f">
<p>
As I said, the defense was carried on BigBlueButton and streamed on YouTube. I
created four different scenes in OBS with various layouts.
</p>
<ol class="org-ol">
<li>Welcome scene, used at the very start of the stream. I used an image (my
first slide), with no camera and no audio.</li>
<li>Deliberation scene, used while the jury is deliberating. I used a different
image (a photo with a written text), with no camera and no audio.</li>
<li>Discussion scene, used during the questions of the jury. I used a window
capture (Xcomposite) of my Firefox window with BBB, cropped by 150px at the
top to remove the URL.</li>
<li>Presentation scene, used during my talk. I used a window capture (Xcomposite)
of my PDF viewer and I added my webcam on the side (video capture
V4L2). Important: I needed to disable video buffering for the camera,
otherwise it was not properly synchronized with the rest (double-click on the
source, then scroll down and untick the box).</li>
</ol>
<p>
In both the scenes 3 and 4, I also had two audio sources. I had the audio output
of my laptop (PulseAudio) to hear the jury and my microphone (Alsa).
</p>

<p>
In all scenes I needed to mute the two default audio sources that appear in the
audio mixer, to truly have no audio in the first two scenes and only the audio I
selected in the two last scenes.
</p>
</div>
</div>
</section>
<section id="outline-container-orgd9647d5" class="outline-2">
<h2 id="orgd9647d5">Using the webcam on several applications simultaneously</h2>
<div class="outline-text-2" id="text-orgd9647d5">
<p>
As described above, I needed to use my webcam in two different applications,
Firefox (for BBB) and OBS. This is not possible natively. To fix that, I found
this <a href="https://debian-facile.org/doc:multimedia:v4l2loopback">tutorial</a> and this <a href="https://askubuntu.com/questions/165727/is-it-possible-for-two-processes-to-access-the-webcam-at-the-same-time">question</a>.
</p>

<p>
First, install the kernel module:
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo apt install v4l2loopback-dkms v4l2loopback-utils ffmpeg
</pre>
</div>

<p>
Load the kernel module and create /dev/video5:
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo modprobe v4l2loopback <span class="org-variable-name">exclusive_caps</span>=1 <span class="org-variable-name">video_nr</span>=5  <span class="org-comment-delimiter"># </span><span class="org-comment">creates `/dev/video5`</span>
</pre>
</div>

<p>
Send the webcam to the virtual device:
</p>
<div class="org-src-container">
<pre class="src src-sh">ffmpeg -i /dev/video0 -f v4l2 -codec:v rawvideo -pix_fmt yuv420p /dev/video5
</pre>
</div>

<p>
Then, we can choose the "dummy device" instead of the default camera in BBB and
OBS.
</p>

<p>
Note: sometimes, when I started Firefox with BBB, for some reason it used the
hardware device for the webcam instead of asking me or using the dummy
device. Here the solution was to revoke the authorization to use the camera, so
that it asks again.
</p>
</div>
</section>
<section id="outline-container-org26106b5" class="outline-2">
<h2 id="org26106b5">Reduce the microphone noise</h2>
<div class="outline-text-2" id="text-org26106b5">
<p>
I used a good microphone (see next section), but still had some white noise in
the background. To fix this, we can process the audio with pulseaudio.
</p>

<p>
I used two links, this <a href="https://askubuntu.com/questions/18958/realtime-noise-removal-with-pulseaudio">question</a> and this <a href="https://www.freedesktop.org/wiki/Software/PulseAudio/Documentation/User/Modules/#module-echo-cancel">documentation</a>.
</p>

<p>
I simply added this line in the file <code>/etc/pulse/default.pa</code>:
</p>
<pre class="example">
load-module module-echo-cancel source_name=noise_cancelled source_properties=device.description=noise_cancelled
</pre>
<p>
Note that we can pass several arguments to the module. This line was enough for
me, but more fancy configurations are possible.
</p>

<p>
Then, simply go to the OS parameters to change the audio input source and choose
<code>noise_cancelled</code>.
</p>
</div>
</section>
<section id="outline-container-org4793b6d" class="outline-2">
<h2 id="org4793b6d">Audio hardware</h2>
<div class="outline-text-2" id="text-org4793b6d">
<p>
In my very first rehearsals, I used the integrated microphone of my laptop. As
expected, the sound was terrible.
</p>

<p>
I have at home a nice little microphone for my camera (the Rode VideoMicro), so
I started to use it, which gave much better results.
</p>

<p>
My laptop had only one jack entry and I needed to plug both the microphone and
the earphone (I could not use the speakers of the laptop, to avoid any
echo). Hence, I bought a cheap <a href="https://www.amazon.fr/gp/product/B07MR5TPKV/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&amp;psc=1">adapter</a>.
</p>

<p>
With this setup, the sound of my microphone was not very good, I could hear some
echo. My guess is that the cheap adapter is crappy and we have signal
interferences between the input and the output. Fortunately, I had at home a
USB DAC headphone amplifier (the FiiO Olympus 2 E10K). Thus, I could plug my
earphones on this amplifier and my microphone directly on the laptop jack entry,
without using the adapter. This is obviously an overkill solution, but this
worked well.
</p>

<p>
An easy alternative would be to use a headset with an integrated microphone, but
I did not have this at home.
</p>
</div>
</section>
</main>
<footer id="postamble" class="status">
<p>Last updated 08 Sep. 2021. Built with <a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.2 (<a href="https://orgmode.org">Org</a> mode 9.4.6). <a href="/README.html">Details</a>.</p>
</footer>
</body>
</html>
